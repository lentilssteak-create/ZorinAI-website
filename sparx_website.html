<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sparx Homework Bot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.9em;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .saved-cred-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .saved-cred-info h3 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .saved-cred-info p {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.85em;
            width: auto;
            margin: 0;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #667eea;
        }

        .select-cred-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .select-cred-item:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .select-cred-item h3 {
            margin-bottom: 5px;
        }

        .select-cred-item p {
            font-size: 0.85em;
            opacity: 0.8;
        }

        .request-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .request-option {
            background: #f8f9fa;
            padding: 30px 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .request-option:hover {
            background: #667eea;
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .request-option h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .request-option p {
            font-size: 0.9em;
        }

        .request-form {
            display: none;
        }

        .request-form.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Sparx Bot</h1>
        <p class="subtitle">Submit your homework requests securely</p>

        <div class="success-message" id="successMessage"></div>
        <div class="error-message" id="errorMessage"></div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('requests')">üìù Requests</button>
            <button class="tab" onclick="switchTab('manage')">‚öôÔ∏è Manage</button>
        </div>

        <!-- Requests Tab -->
        <div class="tab-content active" id="requests">
            <div id="requestOptions" class="request-options">
                <div class="request-option" onclick="showNewRequestForm()">
                    <h3>üìù</h3>
                    <p><strong>New Request</strong></p>
                    <p style="font-size: 0.8em; margin-top: 5px;">Enter details manually</p>
                </div>
                <div class="request-option" onclick="showSavedCredentials()">
                    <h3>üîê</h3>
                    <p><strong>Saved Credentials</strong></p>
                    <p style="font-size: 0.8em; margin-top: 5px;">Use saved account</p>
                </div>
            </div>

            <!-- New Request Form -->
            <div class="request-form" id="newRequestForm">
                <button class="btn btn-secondary" onclick="backToOptions()" style="margin-bottom: 20px;">‚Üê Back</button>
                <form id="requestForm">
                    <div class="form-group">
                        <label for="schoolName">School Name</label>
                        <input type="text" id="schoolName" required placeholder="e.g., Manchester Grammar School">
                    </div>

                    <div class="form-group">
                        <label for="email">Sparx Email</label>
                        <input type="email" id="email" required placeholder="your.email@school.com">
                    </div>

                    <div class="form-group">
                        <label for="password">Sparx Password</label>
                        <input type="password" id="password" required>
                    </div>

                    <div class="form-group">
                        <label for="platform">Platform</label>
                        <select id="platform" required onchange="updateTaskOptions()">
                            <option value="">Choose platform...</option>
                            <option value="maths">üî¢ Maths</option>
                            <option value="science">üî¨ Science</option>
                            <option value="reading">üìö Reading</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="task">Task Type</label>
                        <select id="task" required onchange="updateAmountField()">
                            <option value="">Choose task...</option>
                            <option value="homework">üìù Homework</option>
                        </select>
                    </div>

                    <div class="form-group" id="amountGroup" style="display: none;">
                        <label for="amount" id="amountLabel">Amount</label>
                        <input type="number" id="amount" placeholder="Enter amount">
                    </div>

                    <button type="submit" class="btn">Submit Request</button>
                </form>
            </div>

            <!-- Quick Request Form -->
            <div class="request-form" id="quickRequestForm">
                <button class="btn btn-secondary" onclick="backToOptions()" style="margin-bottom: 20px;">‚Üê Back</button>
                <p id="selectedCredName" style="color: #667eea; margin-bottom: 20px; font-weight: 600;"></p>
                
                <form id="quickForm">
                    <div class="form-group">
                        <label for="quickPlatform">Platform</label>
                        <select id="quickPlatform" required onchange="updateQuickTaskOptions()">
                            <option value="">Choose platform...</option>
                            <option value="maths">üî¢ Maths</option>
                            <option value="science">üî¨ Science</option>
                            <option value="reading">üìö Reading</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="quickTask">Task Type</label>
                        <select id="quickTask" required onchange="updateQuickAmountField()">
                            <option value="">Choose task...</option>
                            <option value="homework">üìù Homework</option>
                        </select>
                    </div>

                    <div class="form-group" id="quickAmountGroup" style="display: none;">
                        <label for="quickAmount" id="quickAmountLabel">Amount</label>
                        <input type="number" id="quickAmount">
                    </div>

                    <button type="submit" class="btn">Submit Request</button>
                </form>
            </div>
        </div>

        <!-- Manage Tab -->
        <div class="tab-content" id="manage">
            <button class="btn" onclick="showAddCredentialForm()">‚ûï Add New Credentials</button>
            
            <div id="credentialsList" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Modal for adding credentials -->
    <div class="modal" id="addCredModal">
        <div class="modal-content">
            <h2>Add Credentials</h2>
            <form id="addCredForm">
                <div class="form-group">
                    <label for="credAlias">Alias</label>
                    <input type="text" id="credAlias" required placeholder="e.g., My Main Account">
                </div>

                <div class="form-group">
                    <label for="credSchool">School Name</label>
                    <input type="text" id="credSchool" required>
                </div>

                <div class="form-group">
                    <label for="credEmail">Email</label>
                    <input type="email" id="credEmail" required>
                </div>

                <div class="form-group">
                    <label for="credPassword">Password</label>
                    <input type="password" id="credPassword" required>
                </div>

                <button type="submit" class="btn">Save Credentials</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('addCredModal')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Modal for selecting saved credentials -->
    <div class="modal" id="selectCredModal">
        <div class="modal-content">
            <h2>Select Credentials</h2>
            <div id="selectCredList"></div>
            <button type="button" class="btn btn-secondary" onclick="closeModal('selectCredModal')">Cancel</button>
        </div>
    </div>

    <script>
        let savedCredentials = [];
        let selectedCredential = null;

        // Load saved credentials from localStorage
        function loadCredentials() {
            const stored = localStorage.getItem('sparxCredentials');
            if (stored) {
                savedCredentials = JSON.parse(stored);
            }
        }

        // Save credentials to localStorage
        function saveCredentials() {
            localStorage.setItem('sparxCredentials', JSON.stringify(savedCredentials));
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'requests') {
                backToOptions();
            } else if (tabName === 'manage') {
                loadSavedCredentials();
            }
        }

        // Request form navigation
        function showNewRequestForm() {
            document.getElementById('requestOptions').style.display = 'none';
            document.getElementById('newRequestForm').classList.add('active');
        }

        function backToOptions() {
            document.getElementById('requestOptions').style.display = 'grid';
            document.getElementById('newRequestForm').classList.remove('active');
            document.getElementById('quickRequestForm').classList.remove('active');
        }

        // Update task options based on platform
        function updateTaskOptions() {
            const platform = document.getElementById('platform').value;
            const taskSelect = document.getElementById('task');
            
            taskSelect.innerHTML = '<option value="">Choose task...</option><option value="homework">üìù Homework</option>';
            
            if (platform === 'reading') {
                taskSelect.innerHTML += '<option value="srp">‚ö° SRP Grinding</option>';
            } else if (platform === 'maths') {
                taskSelect.innerHTML += '<option value="xp">üöÄ XP Grinding</option>';
            }
        }

        function updateQuickTaskOptions() {
            const platform = document.getElementById('quickPlatform').value;
            const taskSelect = document.getElementById('quickTask');
            
            taskSelect.innerHTML = '<option value="">Choose task...</option><option value="homework">üìù Homework</option>';
            
            if (platform === 'reading') {
                taskSelect.innerHTML += '<option value="srp">‚ö° SRP Grinding</option>';
            } else if (platform === 'maths') {
                taskSelect.innerHTML += '<option value="xp">üöÄ XP Grinding</option>';
            }
        }

        // Update amount field based on task
        function updateAmountField() {
            const task = document.getElementById('task').value;
            const amountGroup = document.getElementById('amountGroup');
            const amountLabel = document.getElementById('amountLabel');
            const amountInput = document.getElementById('amount');
            
            if (task === 'srp') {
                amountGroup.style.display = 'block';
                amountLabel.textContent = 'SRP Amount (max 9999)';
                amountInput.max = 9999;
                amountInput.required = true;
            } else if (task === 'xp') {
                amountGroup.style.display = 'block';
                amountLabel.textContent = 'XP Amount (max 9999999)';
                amountInput.max = 9999999;
                amountInput.required = true;
            } else {
                amountGroup.style.display = 'none';
                amountInput.required = false;
            }
        }

        function updateQuickAmountField() {
            const task = document.getElementById('quickTask').value;
            const amountGroup = document.getElementById('quickAmountGroup');
            const amountLabel = document.getElementById('quickAmountLabel');
            const amountInput = document.getElementById('quickAmount');
            
            if (task === 'srp') {
                amountGroup.style.display = 'block';
                amountLabel.textContent = 'SRP Amount (max 9999)';
                amountInput.max = 9999;
                amountInput.required = true;
            } else if (task === 'xp') {
                amountGroup.style.display = 'block';
                amountLabel.textContent = 'XP Amount (max 9999999)';
                amountInput.max = 9999999;
                amountInput.required = true;
            } else {
                amountGroup.style.display = 'none';
                amountInput.required = false;
            }
        }

        // Show/hide modals
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Show messages
        function showSuccess(message) {
            const el = document.getElementById('successMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        function showError(message) {
            const el = document.getElementById('errorMessage');
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        // New request form submission
        document.getElementById('requestForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const requestData = {
                schoolName: document.getElementById('schoolName').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                platform: document.getElementById('platform').value,
                task: document.getElementById('task').value,
                amount: document.getElementById('amount').value || null
            };

            try {
                const response = await fetch('/api/request', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (response.ok) {
                    showSuccess('‚úÖ Request submitted successfully!');
                    e.target.reset();
                    backToOptions();
                } else {
                    showError('‚ùå Failed to submit request');
                }
            } catch (error) {
                showError('‚ùå Network error');
            }
        });

        // Add credential form
        function showAddCredentialForm() {
            showModal('addCredModal');
        }

        document.getElementById('addCredForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newCred = {
                id: Date.now(),
                alias: document.getElementById('credAlias').value,
                schoolName: document.getElementById('credSchool').value,
                email: document.getElementById('credEmail').value,
                password: document.getElementById('credPassword').value
            };

            savedCredentials.push(newCred);
            saveCredentials();
            
            closeModal('addCredModal');
            e.target.reset();
            showSuccess('‚úÖ Credentials saved!');
            loadSavedCredentials();
        });

        // Load and display saved credentials
        function loadSavedCredentials() {
            const list = document.getElementById('credentialsList');
            
            if (savedCredentials.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>No saved credentials yet</p></div>';
                return;
            }

            list.innerHTML = '';
            savedCredentials.forEach(cred => {
                const item = document.createElement('div');
                item.className = 'saved-cred-item';
                item.innerHTML = `
                    <div class="saved-cred-info">
                        <h3>${cred.alias}</h3>
                        <p>${cred.schoolName} ‚Ä¢ ${cred.email}</p>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="deleteCredential(${cred.id})">Delete</button>
                `;
                list.appendChild(item);
            });
        }

        // Delete credential
        function deleteCredential(id) {
            if (confirm('Are you sure you want to delete this credential?')) {
                savedCredentials = savedCredentials.filter(c => c.id !== id);
                saveCredentials();
                loadSavedCredentials();
                showSuccess('‚úÖ Credential deleted');
            }
        }

        // Show saved credentials for quick request
        function showSavedCredentials() {
            if (savedCredentials.length === 0) {
                showError('‚ùå No saved credentials. Add some first in the Manage tab!');
                return;
            }

            const list = document.getElementById('selectCredList');
            list.innerHTML = '';
            
            savedCredentials.forEach(cred => {
                const item = document.createElement('div');
                item.className = 'select-cred-item';
                item.innerHTML = `
                    <h3>${cred.alias}</h3>
                    <p>${cred.schoolName}</p>
                `;
                item.onclick = () => selectCredentialForRequest(cred);
                list.appendChild(item);
            });

            showModal('selectCredModal');
        }

        function selectCredentialForRequest(cred) {
            selectedCredential = cred;
            document.getElementById('selectedCredName').textContent = `Using: ${cred.alias} (${cred.schoolName})`;
            closeModal('selectCredModal');
            
            document.getElementById('requestOptions').style.display = 'none';
            document.getElementById('quickRequestForm').classList.add('active');
        }

        // Quick request form
        document.getElementById('quickForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!selectedCredential) return;

            const requestData = {
                schoolName: selectedCredential.schoolName,
                email: selectedCredential.email,
                password: selectedCredential.password,
                platform: document.getElementById('quickPlatform').value,
                task: document.getElementById('quickTask').value,
                amount: document.getElementById('quickAmount').value || null
            };

            try {
                const response = await fetch('/api/request', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (response.ok) {
                    showSuccess('‚úÖ Request submitted successfully!');
                    e.target.reset();
                    backToOptions();
                } else {
                    showError('‚ùå Failed to submit request');
                }
            } catch (error) {
                showError('‚ùå Network error');
            }
        });

        // Initialize
        loadCredentials();
        loadSavedCredentials();
    </script>
</body>
</html>